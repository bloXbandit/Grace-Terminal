import{e as s,I as Me,p as ie,a2 as ue,a3 as Y,z as Ee,r as p,c as B,a7 as de,i as N,h as _,w as r,Z as pe,$ as Ue,ag as ve,ah as Pe,ai as He,l as k,aj as _e,d as S,D as me,ak as Le,j as ge,q as ze,t as w,F as K,Y as fe,a1 as ye,g as Be,o as Ne,al as De,am as Re,k as h,B as Te,v as Ve,a4 as je,an as Fe,ao as Ke,a5 as Ye,E as qe,G as Ge,f as A}from"./index-DgcqBZ_P.js";import{s as Ze}from"./mcp-Dtb42yOP.js";import{h as m}from"./http-DmdJyNsP.js";import{e as ce}from"./emitter-E5P-NQ8u.js";import{u as be}from"./edit-B_F6FZym.js";var Je={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M928 161H699.2c-49.1 0-97.1 14.1-138.4 40.7L512 233l-48.8-31.3A255.2 255.2 0 00324.8 161H96c-17.7 0-32 14.3-32 32v568c0 17.7 14.3 32 32 32h228.8c49.1 0 97.1 14.1 138.4 40.7l44.4 28.6c1.3.8 2.8 1.3 4.3 1.3s3-.4 4.3-1.3l44.4-28.6C602 807.1 650.1 793 699.2 793H928c17.7 0 32-14.3 32-32V193c0-17.7-14.3-32-32-32zM324.8 721H136V233h188.8c35.4 0 69.8 10.1 99.5 29.2l48.8 31.3 6.9 4.5v462c-47.6-25.6-100.8-39-155.2-39zm563.2 0H699.2c-54.4 0-107.6 13.4-155.2 39V298l6.9-4.5 48.8-31.3c29.7-19.1 64.1-29.2 99.5-29.2H888v488zM396.9 361H211.1c-3.9 0-7.1 3.4-7.1 7.5v45c0 4.1 3.2 7.5 7.1 7.5h185.7c3.9 0 7.1-3.4 7.1-7.5v-45c.1-4.1-3.1-7.5-7-7.5zm223.1 7.5v45c0 4.1 3.2 7.5 7.1 7.5h185.7c3.9 0 7.1-3.4 7.1-7.5v-45c0-4.1-3.2-7.5-7.1-7.5H627.1c-3.9 0-7.1 3.4-7.1 7.5zM396.9 501H211.1c-3.9 0-7.1 3.4-7.1 7.5v45c0 4.1 3.2 7.5 7.1 7.5h185.7c3.9 0 7.1-3.4 7.1-7.5v-45c.1-4.1-3.1-7.5-7-7.5zm416 0H627.1c-3.9 0-7.1 3.4-7.1 7.5v45c0 4.1 3.2 7.5 7.1 7.5h185.7c3.9 0 7.1-3.4 7.1-7.5v-45c.1-4.1-3.1-7.5-7-7.5z"}}]},name:"read",theme:"outlined"};function re(n){for(var l=1;l<arguments.length;l++){var c=arguments[l]!=null?Object(arguments[l]):{},v=Object.keys(c);typeof Object.getOwnPropertySymbols=="function"&&(v=v.concat(Object.getOwnPropertySymbols(c).filter(function(f){return Object.getOwnPropertyDescriptor(c,f).enumerable}))),v.forEach(function(f){Qe(n,f,c[f])})}return n}function Qe(n,l,c){return l in n?Object.defineProperty(n,l,{value:c,enumerable:!0,configurable:!0,writable:!0}):n[l]=c,n}var he=function(l,c){var v=re({},l,c.attrs);return s(Me,re({},v,{icon:Je}),null)};he.displayName="ReadOutlined";he.inheritAttrs=!1;const O="/api/agent",oe={getList(){return m.get(O)},getById(n){return m.get(`${O}/${n}`)},update(n,l,c,v,f){return m.put(`${O}/${n}`,{name:l,describe:c,mcp_server_ids:v,is_public:f})},create(n,l,c,v){return m.post(O,{name:n,describe:l,mcp_server_ids:c,is_public:v})},delete(n){return m.del(`${O}/${n}`)},generate(n,l,c){return m.post(`${O}/generate`,{question:n,conversation_id:l,is_public:c})}},We={class:"mcp-grid"},Xe=["onClick"],et={class:"checkbox-icon"},tt={class:"mcp-content"},at={class:"mcp-name"},nt={class:"mcp-desc"},ot={__name:"agentsEdit",props:{visible:Boolean,id:String},emits:["update:visible","updateList"],setup(n,{emit:l}){const c=ue(),{user:v,membership:f,points:q}=Y(c),G=be(),{agent:M}=Y(G),y=n,b=l,e=Ee({name:"",describe:"",mcpids:[],is_public:!0}),C=p([]),u=p(""),x=p(!1),E=p("Create Agent");p(!1),p("Upgrade");const I=B(()=>!!y.id);B(()=>{var o;return!((o=f.value)!=null&&o.planName)});const $=async()=>{try{const o=await Ze.activate_servers();C.value=Array.isArray(o)?o:[]}catch(o){console.error("Error fetching MCP servers:",o)}},D=()=>{e.name="",e.describe="",e.mcpids=[],e.is_public=!0,u.value=""},R=async()=>{if(console.log("initAgent",y.id),D(),E.value=I.value?"Edit Agent":"Create Agent",!!I.value){x.value=!0;try{const o=await oe.getById(y.id);console.log("res",o),e.name=o.name||"",e.describe=o.describe||"",e.mcpids=o.mcp_server_ids||[],e.is_public=o.is_public}catch(o){console.error("initAgent error",o)}finally{x.value=!1}}};de(()=>y.visible,async o=>{o&&(await $(),await R())});const T=async()=>{if(I.value)await oe.update(y.id,e.name,e.describe,e.mcpids,e.is_public),M.value&&M.value.id===y.id&&(M.value={...M.value,name:e.name,describe:e.describe,mcp_server_ids:e.mcpids,is_public:e.is_public}),ce.emit("updateAgentList");else{let o=await oe.create(e.name,e.describe,e.mcpids);ce.emit("addAgent",o)}b("update:visible",!1)},Z=()=>{D(),b("update:visible",!1)},J=o=>{const g=e.mcpids.indexOf(o);g>-1?e.mcpids.splice(g,1):e.mcpids.push(o)};return(o,g)=>{const Q=Ue,V=pe,W=ve,j=_e,X=ze("a-icon"),ee=He,te=Pe,ae=fe,ne=ye;return _(),N(ne,{open:n.visible,title:E.value,width:"800px",onCancel:Z,onOk:T},{default:r(()=>[s(ae,{model:e,layout:"vertical"},{default:r(()=>[s(V,{label:"Name"},{default:r(()=>[s(Q,{value:e.name,"onUpdate:value":g[0]||(g[0]=d=>e.name=d),placeholder:"Please enter name"},null,8,["value"])]),_:1}),s(V,{label:"Description"},{default:r(()=>[s(W,{value:e.describe,"onUpdate:value":g[1]||(g[1]=d=>e.describe=d),rows:"4",placeholder:"Please enter describe"},null,8,["value"])]),_:1}),s(te,null,{default:r(()=>[s(ee,{key:"1",header:"Select MCP Services"},{default:r(()=>[s(j,{value:u.value,"onUpdate:value":g[2]||(g[2]=d=>u.value=d),placeholder:"Search MCP services",allowClear:"",style:{"margin-bottom":"16px"}},null,8,["value"]),k("div",We,[(_(!0),S(K,null,me(C.value,d=>(_(),S("div",{key:d.id,class:Le(["mcp-card",{selected:e.mcpids.includes(d.id)}]),onClick:a=>J(d.id)},[k("div",et,[e.mcpids.includes(d.id)?(_(),N(X,{key:0,type:"check-circle",style:{color:"#52c41a","font-size":"20px"}})):ge("",!0)]),k("div",tt,[k("div",at,w(d.name),1),k("div",nt,w(d.describe),1)])],10,Xe))),128))])]),_:1})]),_:1})]),_:1},8,["model"])]),_:1},8,["open","title"])}}},ft=ie(ot,[["__scopeId","data-v-80952378"]]),L="/api/knowledge",z={create(n,l,c){return m.post(L,{content:n,category:l,agent_id:c})},getList(n){return m.get(L,{agent_id:n})},getById(n){return m.get(`${L}/detail/${n}`)},update(n,l,c){return m.put(`${L}/${n}`,{content:l,category:c})},delete(n){return m.del(`${L}/${n}`)},getCategoryList(){return m.get("/api/knowledge/categories")}},st={class:"toolbar"},lt={class:"table-container"},ct={key:2,class:"content-ellipsis"},rt={key:0,class:"overlay-mask"},it={class:"overlay-content"},ut={__name:"KnowledgeModal",props:{agentId:{type:Number,default:0}},setup(n,{expose:l}){const c=be(),{agent:v}=Y(c),f=ue(),{user:q,membership:G,points:M}=Y(f),y=Be(),b=p(!1),e=p(!1),C=p(null),u=p({content:"",category:""}),x=p(""),E=p([]),I=p([]),$=p("personal"),D=n;function R(){return D.agentId||v.value.id}const T=B(()=>{var a;return!!((a=G.value)!=null&&a.planName)}),Z=B(()=>$.value==="system"&&!T.value),J=async()=>{try{const a=await z.getCategoryList();I.value=a||[]}catch(a){console.error(a)}},o=async()=>{try{const a=await z.getList(R());E.value=$.value==="system"?a.system||[]:a.personal||[]}catch(a){console.error(a)}},g=async a=>{a==="system"&&T.value,$.value=a,await o()},Q=B(()=>E.value.filter(a=>{var t,U;return((t=a.content)==null?void 0:t.includes(x.value))||((U=a.category)==null?void 0:U.includes(x.value))})),V=()=>{C.value=null,u.value={content:"",category:""},e.value=!0},W=a=>{C.value=a,u.value={content:a.content,category:a.category},e.value=!0},j=async()=>{var a;if(!u.value.content||!u.value.category){A.error("Please complete content and category.");return}try{(a=C.value)!=null&&a.id?(await z.update(C.value.id,u.value.content,u.value.category),A.success("Updated successfully.")):(await z.create(u.value.content,u.value.category,R()),A.success("Added successfully.")),e.value=!1,o()}catch(t){console.error(t),A.error("Operation failed.")}},X=async a=>{try{await z.delete(a),A.success("Deleted successfully."),o()}catch(t){console.error(t),A.error("Failed to delete.")}},ee=()=>{b.value=!1},te=()=>{b.value=!1},ae=()=>{},ne=()=>{const a=localStorage.getItem("access_token"),t=q.value&&q.value.id;!a||!t?y.push({name:"login"}):y.push({name:"pricing"})},d=[{title:"Content",dataIndex:"content",key:"content"},{title:"Category",dataIndex:"category",key:"category"},{title:"Created At",dataIndex:"create_at",key:"create_at",width:200},{title:"Actions",key:"action",width:100}];return Ne(()=>{J()}),de(b,a=>{a&&o()}),l({visible:b}),(a,t)=>{const U=De,ke=Re,Ce=_e,P=Te,we=Ke,xe=Fe,$e=Ye,Se=ve,se=pe,Ie=Ge,Ae=qe,Oe=fe,le=ye;return _(),N(le,{open:b.value,"onUpdate:open":t[7]||(t[7]=F=>b.value=F),title:"Experience Management",width:"900px",onCancel:ee,onOk:te,footer:null,"ok-text":"Close","cancel-button-props":{style:{display:"none"}}},{default:r(()=>{var F;return[s(ke,{activeKey:$.value,"onUpdate:activeKey":t[0]||(t[0]=i=>$.value=i),onChange:g,style:{"margin-bottom":"16px"}},{default:r(()=>[s(U,{key:"personal",tab:"Personal Experience"}),s(U,{key:"system",tab:"System Experience"})]),_:1},8,["activeKey"]),k("div",st,[s(Ce,{value:x.value,"onUpdate:value":t[1]||(t[1]=i=>x.value=i),placeholder:"Please enter content or category","enter-button":"",onSearch:ae,style:{"max-width":"300px"}},null,8,["value"]),s(P,{type:"primary",onClick:V},{default:r(()=>t[8]||(t[8]=[h("Add Experience")])),_:1})]),k("div",lt,[s($e,{columns:d,"data-source":Q.value,"row-key":"id",pagination:{pageSize:5}},{bodyCell:r(({column:i,record:H})=>[i.key==="create_at"?(_(),S(K,{key:0},[h(w(Ve(je)(H[i.dataIndex]).format("YYYY-MM-DD HH:mm")),1)],64)):i.key==="action"?(_(),N(xe,{key:1},{default:r(()=>[s(P,{type:"link",onClick:dt=>W(H)},{default:r(()=>t[9]||(t[9]=[h("Edit")])),_:2},1032,["onClick"]),s(we,{title:"Are you sure to delete?",onConfirm:()=>X(H.id)},{default:r(()=>[s(P,{danger:"",type:"link"},{default:r(()=>t[10]||(t[10]=[h("Delete")])),_:1})]),_:2},1032,["onConfirm"])]),_:2},1024)):i.key==="content"?(_(),S("div",ct,w(H[i.dataIndex]),1)):(_(),S(K,{key:3},[h(w(H[i.dataIndex]),1)],64))]),_:1},8,["data-source"]),Z.value?(_(),S("div",rt,[k("div",it,[h(w(a.$t("setting.experience.systemExperienceRequiresUpgrade"))+" ",1),k("button",{onClick:ne,class:"upgrade"},w(a.$t("member.upgrade")),1)])])):ge("",!0)]),s(le,{open:e.value,"onUpdate:open":t[5]||(t[5]=i=>e.value=i),title:(F=C.value)!=null&&F.id?"Edit Experience":"Add Experience",onOk:j,onCancel:t[6]||(t[6]=i=>e.value=!1),width:700},{footer:r(()=>[s(P,{style:{"background-color":"#1a1a19","border-color":"#1a1a19",color:"#fff"},onClick:j},{default:r(()=>t[11]||(t[11]=[h(" Save ")])),_:1}),s(P,{onClick:t[4]||(t[4]=i=>e.value=!1)},{default:r(()=>t[12]||(t[12]=[h("Cancel")])),_:1})]),default:r(()=>[s(Oe,{model:u.value,layout:"vertical"},{default:r(()=>[s(se,{label:"Content"},{default:r(()=>[s(Se,{value:u.value.content,"onUpdate:value":t[2]||(t[2]=i=>u.value.content=i),rows:12,placeholder:"Enter content here"},null,8,["value"])]),_:1}),s(se,{label:"Category"},{default:r(()=>[s(Ae,{value:u.value.category,"onUpdate:value":t[3]||(t[3]=i=>u.value.category=i),placeholder:"Please select category","allow-clear":""},{default:r(()=>[(_(!0),S(K,null,me(I.value,i=>(_(),N(Ie,{key:i,value:i},{default:r(()=>[h(w(i),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])]),_:1})]),_:1},8,["model"])]),_:1},8,["open","title"])]}),_:1},8,["open"])}}},yt=ie(ut,[["__scopeId","data-v-1db4095a"]]);export{ft as A,yt as K,he as R,oe as s};
