import{p as $,u as U,r as k,o as x,ab as D,f as p,d as h,h as v,l as i,j as C,t as o,e as _,H as R,w,F as V,D as q,i as L,G as M,E as O,a0 as j,ac as G,k as H,B as Z,ad as z,Z as J,ae as E}from"./index-y24F1-rU.js";import{h as S}from"./http-D7M9oJmQ.js";import{e as Q}from"./emitter-E5P-NQ8u.js";import{A as W}from"./driver-BxHdV7Lz.js";const u={async getSearchEngineConfig(){return await S.get("/api/search_provider_setting")||{}},async getSearchEngineTemplates(){return await S.get("/api/search_provider_setting/templates")||{}},async getSearchEngineConfigs(){return await S.get("/api/search_provider_setting/configs")||{}},async updateSearchEngineConfig(c){return(await S.put("/api/search_provider_setting/",c)).data||{}},async checkSearchProvider(c){return await S.post("/api/search_provider_setting/check_search_provider",c)||{}}},X={class:"search-container"},Y={class:"search-choose search-item"},ee={class:"search-choose-header header"},ae={class:"search-choose-list"},te={class:"select-option-content"},se=["src"],ne={key:0,class:"search-choose-api-config"},ie={style:{"white-space":"nowrap"}},re={key:1,class:"search-choose-api-config"},oe={style:{"white-space":"nowrap"}},ce={style:{"white-space":"nowrap"}},le={key:0,href:"https://app.tavily.com/",target:"_blank",class:"get-api-link"},de={key:1,href:"https://console.cloudsway.net/",target:"_blank",class:"get-api-link"},ue={class:"search-rule search-item"},ve={class:"search-rule-header header"},_e={class:"search-number header search-slider-item"},pe={class:"slider"},he={__name:"index",setup(c){const{t}=U(),g=k([]),f=k(!0),l=k(""),e=k({provider_id:1,provider_name:"Tavily",base_config:{api_key:"",endpoint:""},include_date:!0,cover_provider_search:!0,enable_enhanced_mode:!0,result_count:5,blacklist:null}),T=k(!1);let b=null;const N=async()=>{console.log("checkApiKeydasdsa");let a={};if(e.value.provider_name=="Tavily"){if(a.type="tavily",a.api_key=e.value.base_config.api_key,a.api_key==""){p.error(t("setting.searchService.apiKeyRequired"));return}}else if(e.value.provider_name=="Cloudsway"){if(a.type="cloudsway",a.api_key=e.value.base_config.api_key,a.endpoint=e.value.base_config.endpoint,a.api_key==""){p.error(t("setting.searchService.accessKeyRequired"));return}else if(a.endpoint==""){p.error(t("setting.searchService.endpointRequired"));return}}else a.type="local",a.engine=e.value.provider_name;console.log(e.value),T.value=!0;let n=await u.checkSearchProvider(a);T.value=!1,n.status!="fail"?p.success(e.value.provider_name+" "+t("setting.searchService.checkSearchEngineSuccess")):p.error(e.value.provider_name+" "+t("setting.searchService.checkSearchEngineFailed"))},B=async()=>{b=W({animate:!0,showProgress:!0,prevBtnText:t("setting.prevStep"),nextBtnText:t("setting.nextStep"),doneBtnText:t("setting.doneStep"),steps:[{element:"#searchTemplates",popover:{side:"bottom",title:t("setting.searchService.searchService"),description:t("setting.searchService.searchEngineTipsOne"),onNextClick:async()=>{E(()=>{b.moveNext()})}}},{element:".search-choose-api-input",popover:{side:"bottom",title:t("setting.searchService.searchService"),description:t("setting.searchService.searchEngineTipsTwo"),onNextClick:async()=>{E(()=>{localStorage.setItem("tour_end","true"),b.moveNext(),Q.emit("onDefaultModelSetting")})}}}]}),b.drive()};async function K(a){const n=g.value.find(d=>d.name===a).id;try{await u.updateSearchEngineConfig({provider_id:n,include_date:e.value.include_date,cover_provider_search:e.value.cover_provider_search,enable_enhanced_mode:e.value.enable_enhanced_mode,result_count:e.value.result_count,blacklist:e.value.blacklist})}catch{p.error(t("update platform failed"));return}const s=(await u.getSearchEngineConfigs()).find(d=>d.provider_id===n);e.value.base_config=s.base_config||{api_key:"",endpoint:""},e.value.provider_id=n||-1,e.value.provider_name=a||""}function P(a){return a==="Tavily"?t("setting.searchService.tavilyName"):a==="Baidu"?t("setting.searchService.baiduName"):a==="Bing"?t("setting.searchService.bingName"):a==="Cloudsway"?t("setting.searchService.couldswayName"):a}x(async()=>{var a,n,y;localStorage.getItem("tour")==="true"&&localStorage.getItem("tour_end")!=="true"&&B();try{g.value=await u.getSearchEngineTemplates(),f.value=!1;try{const s=await u.getSearchEngineConfig();s.provider_name?(l.value=s.provider_name,e.value={...s},s.provider_name==="Tavily"?(e.value.base_config={api_key:""},e.value.base_config.api_key=((a=s==null?void 0:s.base_config)==null?void 0:a.api_key)||""):s.provider_name==="Cloudsway"?(e.value.base_config={api_key:"",endpoint:""},e.value.base_config.api_key=((n=s==null?void 0:s.base_config)==null?void 0:n.api_key)||"",e.value.base_config.endpoint=((y=s==null?void 0:s.base_config)==null?void 0:y.endpoint)||""):e.value.base_config={}):l.value="Tavily"}catch(s){console.error("Failed to fetch user config:",s),l.value="Tavily"}}catch(s){console.error("Failed to fetch templates:",s),f.value=!1}}),D(()=>{m()});const m=async()=>{try{console.log("当前保存",e.value),e.value.provider_name==="Tavily"?await u.updateSearchEngineConfig({provider_id:e.value.provider_id,api_key:e.value.base_config.api_key,include_date:e.value.include_date,cover_provider_search:e.value.cover_provider_search,enable_enhanced_mode:e.value.enable_enhanced_mode,result_count:e.value.result_count,blacklist:e.value.blacklist}):e.value.provider_name==="Cloudsway"?await u.updateSearchEngineConfig({provider_id:e.value.provider_id,api_key:e.value.base_config.api_key,endpoint:e.value.base_config.endpoint,include_date:e.value.include_date,cover_provider_search:e.value.cover_provider_search,enable_enhanced_mode:e.value.enable_enhanced_mode,result_count:e.value.result_count,blacklist:e.value.blacklist}):await u.updateSearchEngineConfig({provider_id:e.value.provider_id,include_date:e.value.include_date,cover_provider_search:e.value.cover_provider_search,enable_enhanced_mode:e.value.enable_enhanced_mode,result_count:e.value.result_count,blacklist:e.value.blacklist})}catch(a){console.error("Failed to save config:",a),p.error(t("setting.searchService.saveBlacklistFailed"))}};return(a,n)=>{const y=M,s=O,d=j,A=Z,F=z,I=J;return v(),h("div",X,[i("div",Y,[i("div",ee,o(a.$t("setting.searchService.searchProvider")),1),i("div",ae,[_(s,{value:l.value,"onUpdate:value":n[0]||(n[0]=r=>l.value=r),loading:f.value,style:{width:"100%",height:"100%"},id:"searchTemplates",onChange:K},{default:w(()=>[(v(!0),h(V,null,q(g.value,r=>(v(),L(y,{key:r.id,value:r.name},{default:w(()=>[i("div",te,[i("img",{src:r.logo_url,alt:"",class:"logo"},null,8,se),i("span",null,o(P(r.name)),1)])]),_:2},1032,["value"]))),128))]),_:1},8,["value","loading"]),l.value==="Tavily"?(v(),h("div",ne,[i("span",ie,o(a.$t("setting.searchService.apiTips")),1),_(d,{value:e.value.base_config.api_key,"onUpdate:value":n[1]||(n[1]=r=>e.value.base_config.api_key=r),class:"search-choose-api-input",placeholder:a.$t("setting.searchService.apiKeyPlaceholder"),disabled:f.value,onChange:m},null,8,["value","placeholder","disabled"])])):C("",!0),l.value==="Cloudsway"?(v(),h("div",re,[i("span",oe,o(a.$t("setting.searchService.accessKey")),1),_(d,{value:e.value.base_config.api_key,"onUpdate:value":n[2]||(n[2]=r=>e.value.base_config.api_key=r),class:"search-choose-api-input",placeholder:a.$t("setting.searchService.accessKeyPlaceholder"),disabled:f.value,onChange:m},null,8,["value","placeholder","disabled"]),i("span",ce,o(a.$t("setting.searchService.endPoint")),1),_(d,{value:e.value.base_config.endpoint,"onUpdate:value":n[3]||(n[3]=r=>e.value.base_config.endpoint=r),class:"search-choose-api-input",placeholder:a.$t("setting.searchService.endpointPlaceholder"),disabled:f.value,onChange:m},null,8,["value","placeholder","disabled"])])):C("",!0),R(_(A,{class:"save-button",onClick:N,loading:T.value},{default:w(()=>[H(o(a.$t("setting.modelService.check")),1)]),_:1},8,["loading"]),[[G,l.value!=="Lemon"]])]),e.value.provider_name==="Tavily"?(v(),h("a",le,o(a.$t("setting.modelService.getApiKey")),1)):e.value.provider_name==="Cloudsway"?(v(),h("a",de,o(a.$t("setting.modelService.getApiKey")),1)):C("",!0)]),i("div",ue,[i("div",ve,o(a.$t("setting.searchService.generalSettings")),1),i("div",_e,[i("span",null,o(a.$t("setting.searchService.searchResultCount")),1),i("div",pe,[_(I,{style:{height:"10px"}},{default:w(()=>[_(F,{value:e.value.result_count,"onUpdate:value":n[4]||(n[4]=r=>e.value.result_count=r),min:1,max:20,step:1,marks:{1:"1",5:a.$t("setting.searchService.default"),20:"20"},onAfterChange:m},null,8,["value","marks"])]),_:1})])])])])}}},ge=$(he,[["__scopeId","data-v-8fac01f5"]]),fe={class:"search-service"},me={__name:"search",setup(c){return(t,g)=>(v(),h("div",fe,[i("h2",null,o(t.$t("setting.searchService.title")),1),_(ge)]))}},we=$(me,[["__scopeId","data-v-ee36ca85"]]);export{we as default};
